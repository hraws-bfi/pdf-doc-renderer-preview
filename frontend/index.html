<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Go Template Previewer</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="api-banner" id="apiBanner">
      <span>⚠️ API server is unavailable. Please start the backend server on port 8080.</span>
    </div>
    
    <div class="wrap">
      <div class="left">
        <!-- Template Editor -->
        <div class="editor-wrap tpl">
          <div class="editor-header">
            <span>Template (HTML/Go)</span>
            <button id="formatTpl">Format</button>
          </div>
          <div id="tplEditor"></div>
        </div>
        
        <!-- Variables Editor -->
        <div class="editor-wrap vars">
          <div class="editor-header">
            <span>Variables (JSON)</span>
            <button id="formatVars">Format</button>
          </div>
          <div id="varsEditor"></div>
        </div>
        
        <!-- Action Bar -->
        <div class="bar">
          <div class="bar-group">
            <button id="render" class="btn-secondary">Render</button>
            <label><input type="checkbox" id="auto" checked /> Auto-render</label>
          </div>
          <div class="bar-group">
            <input type="text" id="templateName" placeholder="Template name (e.g. data-application)" />
            <button id="save" class="btn-primary">Save Template</button>
            <span id="saveStatus" class="save-status"></span>
          </div>
          <div id="status" class="err"></div>
        </div>
      </div>

      <!-- Preview Panel -->
      <div class="right">
        <div class="hint">
          <span>Preview (rendered HTML in sandboxed iframe)</span>
          <div class="hint-buttons">
            <button id="downloadPdf" class="btn-pdf">Download PDF</button>
            <button id="openUploadModal" class="btn-dms">Upload to DMS</button>
          </div>
        </div>
        <iframe id="preview" sandbox="allow-same-origin" title="Rendered HTML preview"></iframe>
      </div>
    </div>

    <!-- Upload to DMS Modal -->
    <div class="modal-overlay" id="uploadModal">
      <div class="modal">
        <h3>Upload Template to DMS</h3>
        <div class="modal-field">
          <label>Template File</label>
          <select id="dmsFilename"></select>
        </div>
        <div class="modal-field">
          <label>Reference ID (UUID)</label>
          <input type="text" id="dmsRefId" placeholder="e.g. 550e8400-e29b-41d4-a716-446655440000" />
        </div>
        <div class="modal-field">
          <label>ID Type</label>
          <input type="text" id="dmsIdType" value="template" />
        </div>
        <div class="modal-field">
          <label>Document Type</label>
          <input type="text" id="dmsDocType" value="html" />
        </div>
        <div class="modal-field">
          <label>Source System</label>
          <input type="text" id="dmsSourceSystem" value="LORA" />
        </div>
        <div class="modal-field">
          <label>Document Sequence</label>
          <input type="text" id="dmsDocSequence" value="1" />
        </div>
        <div class="modal-actions">
          <button class="btn-cancel" id="closeUploadModal">Cancel</button>
          <button class="btn-upload" id="uploadToDMS">Upload</button>
        </div>
      </div>
    </div>

    <script type="module" src="./app.js"></script>
  </body>
</html>